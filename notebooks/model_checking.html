

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>3. Model checking &mdash; Bayesian workflow  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="4. Model development" href="model_development.html" />
    <link rel="prev" title="2. Model building" href="model_building.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Bayesian workflow
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_building.html">2. Model building</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">3. Model checking</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Implementation-in-Stan">Implementation in Stan</a></li>
<li class="toctree-l2"><a class="reference internal" href="#The-first-check:-fitting-simulated-data">The first check: fitting simulated data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Prior-selection-and-prior-predictive-checks">Prior selection and prior predictive checks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Posterior-predictive-checks">Posterior predictive checks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Application-to-actual-data">Application to actual data</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="model_development.html">4. Model development</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_comparison_part1.html">5. Model comparison (Part I)</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_comparison_part2.html">6. Model comparison (Part II)</a></li>
<li class="toctree-l1"><a class="reference internal" href="experiment_design.html">7. Experiment design</a></li>
<li class="toctree-l1"><a class="reference internal" href="homework_project.html">8. Homework project</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Bayesian workflow</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>3. Model checking</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/notebooks/model_checking.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="3.-Model-checking">
<h1>3. Model checking<a class="headerlink" href="#3.-Model-checking" title="Permalink to this headline">¶</a></h1>
<p>Last time we focussed on building a simple initial model for the Cepheid variable data. In this notebook, we explore the next steps in the workflow, <strong>model implementation</strong> and <strong>model checking</strong>. Along the way, we’ll also introduce <strong>prior predictive checks</strong> and <strong>posterior predictive checks</strong>.</p>
<section id="Implementation-in-Stan">
<h2>Implementation in Stan<a class="headerlink" href="#Implementation-in-Stan" title="Permalink to this headline">¶</a></h2>
<p>In the <a class="reference internal" href="model_building.html"><span class="doc">model building notebook</span></a>, we developed a simple model to fit the period-luminosity relation of Cepheid variable stars. We can now implement this model in Stan and use it to infer the parameters <span class="math notranslate nohighlight">\(\alpha\)</span> and <span class="math notranslate nohighlight">\(\beta\)</span> that describe the relation.</p>
<p>As we’ve seen before in the <a class="reference internal" href="introduction.html"><span class="doc">introduction notebook</span></a>, Stan files consist of different blocks that divide information into <code class="docutils literal notranslate"><span class="pre">data</span></code>, <code class="docutils literal notranslate"><span class="pre">parameters</span></code> and <code class="docutils literal notranslate"><span class="pre">model</span></code>. You can find more detailed information on how to write models in Stan code <a class="reference external" href="https://mc-stan.org/docs/2_27/reference-manual/index.html#overview">here</a>, but for now we can just take a look at this model: <code class="docutils literal notranslate"><span class="pre">stan/cepheid_v0.stan</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>!cat stan/cepheid_v0.stan
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
/**
 * Initial model for Cepheid variables
 * - Single galaxy
 * - Shared sigma_m
 **/

data {

  /* usual inputs */
  int Nc; // number of Cepheids
  vector[Nc] m_obs; // obs apparent mag.
  real sigma_m; // mag uncertainty
  vector[Nc] log10P; // log10(periods/days)
  real z; // redshift of single galaxy

  /* for generated quantities */
  int Ngrid;
  vector[Ngrid] log10P_grid;
}

transformed data {

  real dL;

  /* luminosity distance */
  dL = (3.0e5 * z) / 70.0; // Mpc

}

parameters {

  /* parameters of the P-L relation */
  real alpha;
  real beta;

}

transformed parameters {

  vector[Nc] M_true;
  vector[Nc] m_true;

  /* P-L relation */
  M_true = alpha + beta * log10P;

  /* convert to m */
  m_true = M_true + 5 * log10(dL) + 25;

}

model {

  /* likelihood */
  m_obs ~ normal(m_true, sigma_m);

}

generated quantities {

  vector[Ngrid] line;

  /* generate the posterior for the P-L relation */
  line = alpha + beta * log10P_grid;

}
</pre></div></div>
</div>
<p>A few things to note: * We could have left the <code class="docutils literal notranslate"><span class="pre">M</span></code> &lt;-&gt; <code class="docutils literal notranslate"><span class="pre">m</span></code> conversion outside of Stan for a more compact program, but it is quite easy to have it inside, meaning that our work in this notebook is simplified. * We could cut out the <code class="docutils literal notranslate"><span class="pre">transformed</span> <span class="pre">parameters</span></code> block and replace <code class="docutils literal notranslate"><span class="pre">m_true</span></code> with a long expression in the <code class="docutils literal notranslate"><span class="pre">model</span></code> block, but this is easy to read and gives us direct access to the <code class="docutils literal notranslate"><span class="pre">M_true</span></code> and <code class="docutils literal notranslate"><span class="pre">m_true</span></code> distributions, as we will see later. * The <code class="docutils literal notranslate"><span class="pre">generated</span> <span class="pre">quantities</span></code> block
is not part of the statistical model, but is run once for every iteration of the sampler. This can be useful for generating simple outputs, again as we will see later.</p>
<p>What about priors??</p>
<p>The more awake amongst you may notice that we have explicitly specified data, parameters and a likelihood in the Stan code, but no prior. A Bayesian analysis requires specification of the priors, so what is going on? By default, Stan will assume a uniform prior over the range of the parameters that you specified. Here, we specify <code class="docutils literal notranslate"><span class="pre">alpha</span></code> and <code class="docutils literal notranslate"><span class="pre">beta</span></code> with no bounds, and so our prior is implicitly uniform over all the real numbers. Does this sound reasonable? In any case, we will run with it
for now, and talk about priors more later in this notebook.</p>
<p>Next, let’s set up our environment and compile our model to get ready to fit some data.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>import numpy as np
from matplotlib import pyplot as plt
import arviz as av
from cmdstanpy import CmdStanModel
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>cepheid_v0 = CmdStanModel(stan_file=&quot;stan/cepheid_v0.stan&quot;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:cmdstanpy:found newer exe file, not recompiling
INFO:cmdstanpy:compiled model file: /Users/fran/projects/BayesianWorkflow/src/notebooks/stan/cepheid_v0
</pre></div></div>
</div>
</section>
<section id="The-first-check:-fitting-simulated-data">
<h2>The first check: fitting simulated data<a class="headerlink" href="#The-first-check:-fitting-simulated-data" title="Permalink to this headline">¶</a></h2>
<p>While we developed our initial generative and statistical models with the goal to fit <em>real</em> data, in doing so we now have a simple simulation program that contains exactly the same information as is included in our model. We can use this to generate <em>simulated</em> data where we <em>know</em> the values of <code class="docutils literal notranslate"><span class="pre">alpha</span></code> and <code class="docutils literal notranslate"><span class="pre">beta</span></code>, and can verify that our fit gives us reasonable results.</p>
<p><img alt="Fitting simulated data" class="no-scaled-link" src="../_images/sim_fit.pdf" style="width: 300px;" /></p>
<p>If we are not able to recover the known simulated truth, this means there is some kind of discrepancy between the generative model and the statistical model. This fact can be a <strong>powerful tool for debugging</strong>, especially when working with more complex models, as it allows us to check if our Stan model is doing what we think it should be. <em>Just because it compiles, it doesn’t mean that it is correct!</em></p>
<p>So, let’s use our work in the <a class="reference internal" href="model_building.html"><span class="doc">model building</span></a> to simulate a test dataset using the same assumptions that we did there:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># known quantities
z = 0.005

Nc = 10
P = [71.5, 45.0, 19.9, 30.6, 8.8, 75.2, 21.5, 22.0, 34.5, 87.4] # days
sigma_m = 0.5

c = 3.0e5 # km/s
H0 = 70.0 # km/s/Mpc

# high-level parameter values
alpha_true = -2
beta_true = -4
</pre></div>
</div>
</div>
<p>You can copy over your simulation code, or load data that you saved last time. I’ll load some data that I simulated earlier:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>m_obs = np.array([21.30057715, 22.89477067, 24.63106411,
                  22.72569458, 26.29936958, 22.34729756,
                  24.19867534, 24.64700615, 23.19478031, 21.94968928])
</pre></div>
</div>
</div>
<p>We can now define our <code class="docutils literal notranslate"><span class="pre">data</span></code> dict to pass to the Stan model…</p>
<blockquote>
<div><p>Note: The variable names in the Stan file must match the keys of the dict</p>
</div></blockquote>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>data = {}
data[&quot;Nc&quot;] = Nc
data[&quot;z&quot;] = z
data[&quot;log10P&quot;] = np.log10(P)
data[&quot;m_obs&quot;] = m_obs
data[&quot;sigma_m&quot;] = sigma_m

# for generated quantities
data[&quot;Ngrid&quot;] = 50
data[&quot;log10P_grid&quot;] = np.linspace(0, 3)
</pre></div>
</div>
</div>
<p>… and try to fit the simulated data</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># run fit
fit = cepheid_v0.sample(data=data, iter_sampling=1000, chains=4)

# check diagnostics
fit.diagnose();

# print summary
fit.summary()
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:cmdstanpy:start chain 1
INFO:cmdstanpy:start chain 2
INFO:cmdstanpy:start chain 3
INFO:cmdstanpy:start chain 4
INFO:cmdstanpy:finish chain 2
INFO:cmdstanpy:finish chain 1
INFO:cmdstanpy:finish chain 3
INFO:cmdstanpy:finish chain 4
INFO:cmdstanpy:Processing csv files: /var/folders/8d/cyg0_lx54mggm8v350vlx91r0000gn/T/tmpmlkdxck8/cepheid_v0-202108271019-1-hce0fjz2.csv, /var/folders/8d/cyg0_lx54mggm8v350vlx91r0000gn/T/tmpmlkdxck8/cepheid_v0-202108271019-2-ecyi9p7i.csv, /var/folders/8d/cyg0_lx54mggm8v350vlx91r0000gn/T/tmpmlkdxck8/cepheid_v0-202108271019-3-_xo9pdvk.csv, /var/folders/8d/cyg0_lx54mggm8v350vlx91r0000gn/T/tmpmlkdxck8/cepheid_v0-202108271019-4-j47jnkvj.csv

Checking sampler transitions treedepth.
Treedepth satisfactory for all transitions.

Checking sampler transitions for divergences.
No divergent transitions found.

Checking E-BFMI - sampler transitions HMC potential energy.
E-BFMI satisfactory.

Effective sample size satisfactory.

Split R-hat values satisfactory all parameters.

Processing complete, no problems detected.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Mean</th>
      <th>MCSE</th>
      <th>StdDev</th>
      <th>5%</th>
      <th>50%</th>
      <th>95%</th>
      <th>N_Eff</th>
      <th>N_Eff/s</th>
      <th>R_hat</th>
    </tr>
    <tr>
      <th>name</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>lp__</th>
      <td>-4.8</td>
      <td>0.0320</td>
      <td>1.00</td>
      <td>-6.9</td>
      <td>-4.5</td>
      <td>-3.800</td>
      <td>1000.0</td>
      <td>4300.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>alpha</th>
      <td>-1.3</td>
      <td>0.0340</td>
      <td>0.83</td>
      <td>-2.7</td>
      <td>-1.3</td>
      <td>0.036</td>
      <td>590.0</td>
      <td>2500.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>beta</th>
      <td>-4.5</td>
      <td>0.0220</td>
      <td>0.54</td>
      <td>-5.4</td>
      <td>-4.5</td>
      <td>-3.600</td>
      <td>580.0</td>
      <td>2500.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>M_true[1]</th>
      <td>-9.7</td>
      <td>0.0076</td>
      <td>0.24</td>
      <td>-10.0</td>
      <td>-9.7</td>
      <td>-9.300</td>
      <td>1016.0</td>
      <td>4304.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>M_true[2]</th>
      <td>-8.8</td>
      <td>0.0036</td>
      <td>0.18</td>
      <td>-9.1</td>
      <td>-8.8</td>
      <td>-8.500</td>
      <td>2440.0</td>
      <td>10341.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>line[46]</th>
      <td>-14.0</td>
      <td>0.0270</td>
      <td>0.68</td>
      <td>-15.0</td>
      <td>-14.0</td>
      <td>-13.000</td>
      <td>621.0</td>
      <td>2633.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>line[47]</th>
      <td>-14.0</td>
      <td>0.0290</td>
      <td>0.72</td>
      <td>-15.0</td>
      <td>-14.0</td>
      <td>-13.000</td>
      <td>618.0</td>
      <td>2620.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>line[48]</th>
      <td>-14.0</td>
      <td>0.0300</td>
      <td>0.75</td>
      <td>-16.0</td>
      <td>-14.0</td>
      <td>-13.000</td>
      <td>614.0</td>
      <td>2603.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>line[49]</th>
      <td>-15.0</td>
      <td>0.0320</td>
      <td>0.78</td>
      <td>-16.0</td>
      <td>-15.0</td>
      <td>-13.000</td>
      <td>612.0</td>
      <td>2592.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>line[50]</th>
      <td>-15.0</td>
      <td>0.0330</td>
      <td>0.81</td>
      <td>-16.0</td>
      <td>-15.0</td>
      <td>-14.000</td>
      <td>609.0</td>
      <td>2582.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
<p>73 rows × 9 columns</p>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># to access chains of parameter values
alpha_chain = fit.stan_variable(&quot;alpha&quot;)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># plot trace
av.plot_trace(fit, var_names=[&quot;alpha&quot;, &quot;beta&quot;, &quot;m_true&quot;]);
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_model_checking_15_0.png" src="../_images/notebooks_model_checking_15_0.png" />
</div>
</div>
<p>So by including <code class="docutils literal notranslate"><span class="pre">m_true</span></code> in the <code class="docutils literal notranslate"><span class="pre">transformed</span> <span class="pre">parameters</span></code> block, we also get the marginal distributions ready-made for free. Different chains have different linestyles and different Cepheids have different colours in this plot.</p>
<p><strong>Exercise 1 (5 points):</strong> Looking closely, it seems that the <code class="docutils literal notranslate"><span class="pre">m_true</span></code> distributions vary from star to star, with medium <code class="docutils literal notranslate"><span class="pre">m_true</span></code> values having narrower distributions. We know <code class="docutils literal notranslate"><span class="pre">sigma_m</span></code> is fixed, so why might this be?</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>ax = av.plot_pair(fit, var_names=[&quot;alpha&quot;, &quot;beta&quot;], marginals=True)

# overlay truth in red
ax[1,0].axvline(alpha_true, color=&quot;r&quot;)
ax[1,0].axhline(beta_true, color=&quot;r&quot;)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.lines.Line2D at 0x1467e8d60&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_model_checking_17_1.png" src="../_images/notebooks_model_checking_17_1.png" />
</div>
</div>
<p>We can see that we are able to recover the true result, although <code class="docutils literal notranslate"><span class="pre">alpha</span></code> and <code class="docutils literal notranslate"><span class="pre">beta</span></code> are quite correlated. Going back to the fit summary, we see that the number of effective samples is quite low - only ~500 for 4x1000 iterations! This fit is very fast and so we could just run it longer, but a common reparametrisation for slopes and intercepts could make the sampling much more efficient.</p>
<p><strong>Exercise 2 (5 points):</strong> Try using the following reparametrisation for the period-luminosity relation:</p>
<div class="math notranslate nohighlight">
\[y = \alpha + \beta x \rightarrow y = \alpha^\prime + \beta (x - x_0)\]</div>
<p>where <span class="math notranslate nohighlight">\(x_0\)</span> is roughly the mean value of <span class="math notranslate nohighlight">\(x\)</span>, typically called the <em>pivot</em>. Compare the number of effective samples with the previous version. Additionally, compare the joint posterior for <code class="docutils literal notranslate"><span class="pre">alpha</span></code> and <code class="docutils literal notranslate"><span class="pre">beta</span></code> with that for <code class="docutils literal notranslate"><span class="pre">alpha_prime</span></code> and <code class="docutils literal notranslate"><span class="pre">beta</span></code>. Why is this parametrisation so much more efficient?</p>
<p>We can also use our <code class="docutils literal notranslate"><span class="pre">generated</span> <span class="pre">quantities</span></code> block to quickly visualise the posterior for the line fit:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>line = fit.stan_variable(&quot;line&quot;)

# 4x1000 iterations, grid of Ngrid points
np.shape(line)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(4000, 50)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># get M_obs
dL = (c * z) / H0
M_obs = m_obs - 25 - 5 * np.log10(dL)

# for plot
Np = 200
log10P_grid = data[&quot;log10P_grid&quot;]
line = fit.stan_variable(&quot;line&quot;)

fig, ax = plt.subplots()
fig.set_size_inches(10, 7)

# approximate X% regions of highest posterior density
level = 99 #%
ax.fill_between(log10P_grid, np.percentile(line, 50 - 0.5*level, axis=0),
               np.percentile(line, 50 + 0.5*level, axis=0), color=&quot;k&quot;, alpha=0.2)
level = 60 #%
ax.fill_between(log10P_grid, np.percentile(line, 50 - 0.5*level, axis=0),
               np.percentile(line, 50 + 0.5*level, axis=0), color=&quot;k&quot;, alpha=0.4)
level = 20 #%
ax.fill_between(log10P_grid, np.percentile(line, 50 - 0.5*level, axis=0),
               np.percentile(line, 50 + 0.5*level, axis=0), color=&quot;k&quot;, alpha=1)
ax.scatter(np.log10(P), M_obs, color=&quot;b&quot;, label=&quot;Data&quot;)
ax.plot(log10P_grid, alpha_true + beta_true * log10P_grid, color=&quot;r&quot;, lw=3,
        linestyle=&quot;--&quot;, label=&quot;Truth&quot;)
ax.invert_yaxis()
ax.legend()
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x1466eadf0&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_model_checking_20_1.png" src="../_images/notebooks_model_checking_20_1.png" />
</div>
</div>
</section>
<section id="Prior-selection-and-prior-predictive-checks">
<h2>Prior selection and prior predictive checks<a class="headerlink" href="#Prior-selection-and-prior-predictive-checks" title="Permalink to this headline">¶</a></h2>
<p>As discussed in Section 3.1, we left our priors for <code class="docutils literal notranslate"><span class="pre">alpha</span></code> and <code class="docutils literal notranslate"><span class="pre">beta</span></code> to be uniform over all real numbers. In the end, this didn’t seem to be a major problem and the data were informative enough to constrain the posterior. However, we should be wary of these kind of <em>uninformative priors</em>. The first motivation is common sense - from studying the data and literature, we have a fairly good idea of what the period-luminosity relationship looks like. Additionally, our sampler currently has to
consider <code class="docutils literal notranslate"><span class="pre">alpha</span></code> and <code class="docutils literal notranslate"><span class="pre">beta</span></code> values from <em>negative to positive infinity</em>.</p>
<p>It is rarely the case that we have zero prior knowledge on the value of our model parameters. At the same time, we don’t want to bias our results by introduing too much information with so-called <em>informative priors</em>. After all, we are trying to find out what the values of <code class="docutils literal notranslate"><span class="pre">alpha</span></code> and <code class="docutils literal notranslate"><span class="pre">beta</span></code> are.</p>
<p>Like many things in life, there is a happy medium between these two extremes that we can use in practice. <em>Weakly informative priors</em> are wide enough to reflect our ignorance, but narrow enough to constrain the parameter space to sensible values. The exact shape of a weakly informative prior should have negligible impact on the fit results.</p>
<p>To help us choose sensible informative priors, we can use <strong>prior predictive checks</strong>. This just means sampling from the prior distribution in your generative model, and comparing the resulting data with your actual data. The idea is that the prior predictive data should cover a wide enough region to cover all reasonable data values, and visualising priors this way in the “data-space” can be helpful in prior selection.</p>
<p><strong>Exercise 3 (5 points):</strong> Expand your generative model to sample from the prior distributions for <code class="docutils literal notranslate"><span class="pre">alpha</span></code> and <code class="docutils literal notranslate"><span class="pre">beta</span></code>. Plot the resulting data (<code class="docutils literal notranslate"><span class="pre">m_obs</span></code> and <code class="docutils literal notranslate"><span class="pre">P</span></code>) for a few different choices of prior distributions.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># to be completed
#alpha = np.random...
#beta = np.random...

# simulation as before
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># plot for different assumptions
</pre></div>
</div>
</div>
<p>Your results should look something like the following:</p>
<p><img alt="Prior predictive checks" class="no-scaled-link" src="../_images/prior_predictive.pdf" style="width: 500px;" /></p>
<p>For our problem, let’s update the Stan model with the following priors:</p>
<div class="math notranslate nohighlight">
\[\alpha \sim N(0, 10)\]</div>
<div class="math notranslate nohighlight">
\[\beta \sim N(-5, 5)~\rm{for}~\beta \lt 0,\]</div>
<p>where the extra constraint on <span class="math notranslate nohighlight">\(\beta\)</span> reflects the fact that we expect a negative slope.</p>
<p>The new stan model can be found in <code class="docutils literal notranslate"><span class="pre">stan/cepheid_v1.stan</span></code>. Note the <code class="docutils literal notranslate"><span class="pre">&lt;upper=0&gt;</span></code> syntax for parameter bounds and the new priors in the <code class="docutils literal notranslate"><span class="pre">model</span></code> block.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>!cat stan/cepheid_v1.stan
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
/**
 * Initial model for Cepheid variables
 * - Single galaxy
 * - Shared sigma_m
 * - Weakly informative priors
 **/

data {

  /* usual inputs */
  int Nc; // number of Cepheids
  vector[Nc] m_obs; // obs apparent mag.
  real sigma_m; // mag uncertainty
  vector[Nc] log10P; // log10(periods/days)
  real z; // redshift of single galaxy

  /* for generated quantities */
  int Ngrid;
  vector[Ngrid] log10P_grid;
}

transformed data {

  real dL;

  /* luminosity distance */
  dL = (3.0e5 * z) / 70.0; // Mpc

}

parameters {

  /* parameters of the P-L relation */
  real alpha;
  real&lt;upper=0&gt; beta;

}

transformed parameters {

  vector[Nc] M_true;
  vector[Nc] m_true;

  /* P-L relation */
  M_true = alpha + beta * log10P;

  /* convert to m */
  m_true = M_true + 5 * log10(dL) + 25;

}

model {

  /* priors */
  alpha ~ normal(0, 10);
  beta ~ normal(-5, 5);

  /* likelihood */
  m_obs ~ normal(m_true, sigma_m);

}

generated quantities {

  vector[Ngrid] line;

  /* generate the posterior for the P-L relation */
  line = alpha + beta * log10P_grid;

}
</pre></div></div>
</div>
<p>Let’s fit this model instead, and see how it performs.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>stan_model = CmdStanModel(stan_file=&quot;stan/cepheid_v1.stan&quot;)
fit = stan_model.sample(data=data, iter_sampling=1000, chains=4)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:cmdstanpy:found newer exe file, not recompiling
INFO:cmdstanpy:compiled model file: /Users/fran/projects/BayesianWorkflow/src/notebooks/stan/cepheid_v1
INFO:cmdstanpy:start chain 1
INFO:cmdstanpy:start chain 2
INFO:cmdstanpy:start chain 3
INFO:cmdstanpy:start chain 4
INFO:cmdstanpy:finish chain 1
INFO:cmdstanpy:finish chain 2
INFO:cmdstanpy:finish chain 3
INFO:cmdstanpy:finish chain 4
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># for plot
log10P_grid = data[&quot;log10P_grid&quot;]
line = fit.stan_variable(&quot;line&quot;)

fig, ax = plt.subplots()
fig.set_size_inches(10, 7)

# approximate X% regions of highest posterior density
level = 99 #%
ax.fill_between(log10P_grid, np.percentile(line, 50 - 0.5*level, axis=0),
               np.percentile(line, 50 + 0.5*level, axis=0), color=&quot;k&quot;, alpha=0.2)
level = 60 #%
ax.fill_between(log10P_grid, np.percentile(line, 50 - 0.5*level, axis=0),
               np.percentile(line, 50 + 0.5*level, axis=0), color=&quot;k&quot;, alpha=0.4)
level = 20 #%
ax.fill_between(log10P_grid, np.percentile(line, 50 - 0.5*level, axis=0),
               np.percentile(line, 50 + 0.5*level, axis=0), color=&quot;k&quot;, alpha=1)
ax.plot(log10P_grid, alpha_true + beta_true * log10P_grid, color=&quot;r&quot;, lw=3,
        linestyle=&quot;--&quot;, label=&quot;Truth&quot;)
ax.invert_yaxis()
ax.legend()
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x1463d2400&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_model_checking_29_1.png" src="../_images/notebooks_model_checking_29_1.png" />
</div>
</div>
<p>We see that the prior choice has negligible impact on the results.</p>
<p><strong>Exercise 4 (5 points):</strong> Experiment with stronger priors and/or weaker data to see how this affects the inferred relation. Make some plots to visualise your results.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># to be completed...
</pre></div>
</div>
</div>
</section>
<section id="Posterior-predictive-checks">
<h2>Posterior predictive checks<a class="headerlink" href="#Posterior-predictive-checks" title="Permalink to this headline">¶</a></h2>
<p>If our model fits the data well, then data generated by the model should look similar to observed data. To test if this is true, we can perform a <strong>posterior predictive check</strong>.</p>
<p>If we have observed data <span class="math notranslate nohighlight">\(\hat{m}\)</span> and model parameters <span class="math notranslate nohighlight">\(\alpha\)</span> and <span class="math notranslate nohighlight">\(\beta\)</span>, we can express the joint posterior predictive distribution as</p>
<div class="math notranslate nohighlight">
\[p(\hat{m}_\mathrm{rep} | \hat{m}) = \int \mathrm{d}\alpha \int \mathrm{d}\beta~p(\hat{m}_\mathrm{rep}| \alpha, \beta) p(\alpha, \beta | \hat{m}),\]</div>
<p>where <span class="math notranslate nohighlight">\(\hat{m}_\mathrm{rep}\)</span> is the <em>replicated</em> data predicted by our fitted model. We can think of this as the data our model predicts we should see in future.</p>
<p>In practice, we can easily compute this integral using the Markov chains that we get from Stan. All we have to do is use the posterior samples for <span class="math notranslate nohighlight">\(\alpha\)</span> and <span class="math notranslate nohighlight">\(\beta\)</span> to forward simulate data from our likelihood, or generative model.</p>
<p><strong>Exercise 5 (5 points):</strong> Let’s compute the posterior predictive distribution for our fit to simulated data…</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>alpha_chain = fit.stan_variable(&quot;alpha&quot;)
beta_chain = fit.stan_variable(&quot;beta&quot;)

Nreps = 250

for i in range(Nreps):
    pass
    # to be completed...
    # sample alpha and beta from chains

    # simulate to get m_obs_rep

    # plot comparison of many simulated m_obs_rep datasets with m_obs used in fit
    # or equivalently for M_obs_rep/M_obs
</pre></div>
</div>
</div>
<p>Your results should look something like the following:</p>
<p><img alt="Prior predictive checks" class="no-scaled-link" src="../_images/posterior_predictive.pdf" style="width: 500px;" /></p>
<p>There are a number of ways to study and quantify the posterior predictive distribution in order to use it to assess the “goodness of fit” of a model. Here, we only consider graphical checks, but more information can be found in Section 6.3 of <a class="reference external" href="http://www.stat.columbia.edu/~gelman/book/">Bayesian Data Analysis</a> by Gelman et al.</p>
</section>
<section id="Application-to-actual-data">
<h2>Application to actual data<a class="headerlink" href="#Application-to-actual-data" title="Permalink to this headline">¶</a></h2>
<p><strong>Homework exercise 1 (20 points):</strong> Now, let’s use our <code class="docutils literal notranslate"><span class="pre">cepheid_v1.stan</span></code> model to fit the actual data introduced in the <a class="reference internal" href="model_building.html"><span class="doc">model building notebook</span></a>. Here we have a model for one galaxy only, so let’s pick one at random to start with. Complete the following steps: * Note that the actual data have individual <code class="docutils literal notranslate"><span class="pre">sigma_m</span></code> for each Cepheid. We want to use as much information as possible, so quickly expand the Stan model to include this. * Fit the data. Make a plot
summarising the posterior of the line fit and compare it to the <code class="docutils literal notranslate"><span class="pre">M_obs</span></code> data values. * Complete a posterior predictive check for this fit. * Repeat steps 2 and 3 for a few other galaxies to compare. Comment on the overall results.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># to be completed...
</pre></div>
</div>
</div>
<p>The above exercise should leave us feeling unsatisfied with out model. We seek out an expert to discuss with, and learn the following information: * The metallicity of a Cepheid has a systematic effect on its intrinsic brightness, shifting it by a factor of <span class="math notranslate nohighlight">\(\gamma=1.5\)</span> * We don’t know the uncertainty in the observed period values - it is likely small, but maybe it is not measured perfectly. * The frequency or “cadence” of astronomical observations means that it is only possible to
measure certain periods.</p>
<p><strong>Homework exercise 2 (30 points):</strong> Use the above information together with the completed posterior predictive checks to improve your Stan model. Some changes may be more useful than others, so it can be good to test each in isolation. Once you are satisfied with your single galaxy model, save it as <code class="docutils literal notranslate"><span class="pre">cepheid_v2.stan</span></code>, and make some plots arguing your case.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># to be completed...
</pre></div>
</div>
</div>
<p><strong>Homework exercise 3 (30 points):</strong> Use your improved model, <code class="docutils literal notranslate"><span class="pre">cepheid_v2.stan</span></code> to fit the data from each galaxy independently. Make some plots showing the resulting <code class="docutils literal notranslate"><span class="pre">alpha</span></code> and <code class="docutils literal notranslate"><span class="pre">beta</span></code> marginal posteriors for the different galaxies (e.g. ridgeline plots can be a nice way to show this). What can you conclude about the universailty of the period-luminosity relation?</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># to be completed...
</pre></div>
</div>
</div>
</section>
</section>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="model_development.html" class="btn btn-neutral float-right" title="4. Model development" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="model_building.html" class="btn btn-neutral float-left" title="2. Model building" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Francesca Capel.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>